{"pageProps":{"article":{"id":267,"documentId":"zpf2m4dks36ri1sxzpkhq91u","title":"【PDF操作比較】PyMuPDFでPDFからテキストも表も簡単抽出","content":"PDF操作ライブラリの比較検討記事の続きです。\n\n前回までの記事はこちら\n\n- [【PDF操作比較】pypdfでPDFからテキスト抽出を行う方法](https://blog.raisex.jp/articles/i402h46inwv9yzy1mgah101z)\n- [【PDF操作比較】pdfplumberでPDFからテキストも表も簡単抽出](https://blog.raisex.jp/articles/g8z0fn5ap0si8r1iheg2iwd7)\n\nPDFデータの前処理において、**テキスト抽出**と**表形式データの抽出**は非常に重要な作業です。今回紹介するのは、Pythonライブラリの**PyMuPDF**を活用したPDFデータの抽出方法です。PyMuPDFは、速度と柔軟性に優れたPDF操作ライブラリで、シンプルなAPI設計が特徴です。\n\n---\n\n# PyMuPDFの特徴\n\n- **軽量で高速**: 大量のPDFファイルでも効率よく処理できます。\n- **多機能**: テキスト抽出だけでなく、表や画像の抽出、PDF編集も可能。\n- **RAGやLLMに最適**: 抽出結果を後続処理に簡単に利用できます。\n\n今回は、基本的なテキスト抽出と表抽出にフォーカスして解説します。\n\n---\n\n# PyMuPDFを使ったテキスト抽出\n\n## PyMuPDFのインストール\n\n以下のコマンドを実行してインストールします：\n\n```bash\npip install PyMuPDF\n```\n\n## サンプルコード\n\n以下のコードは、PDFからテキストを抽出し、ファイルに保存するシンプルな例です。\n\n```python\nimport os\nimport pymupdf\n\ninput_pdf_path = \"./docs/読み取りテスト文書.pdf\"\noutput_txt_path = \"./output/text_extract.txt\"\n\ndef extract_text_with_pymupdf(input_path, output_path):\n    try:\n        doc = pymupdf.open(input_path)\n        extracted_text = \"\"\n\n        for page in doc:\n            extracted_text += page.get_text()\n\n        output_dir = os.path.dirname(output_path)\n        if not os.path.exists(output_dir):\n            os.makedirs(output_dir)\n\n        with open(output_path, \"w\", encoding=\"utf-8\") as f:\n            f.write(extracted_text)\n\n        print(f\"テキストが正常に抽出され、以下のファイルに保存されました: {output_path}\")\n    except Exception as e:\n        print(f\"エラーが発生しました: {e}\")\n\n# 実行\nif __name__ == \"__main__\":\n    extract_text_with_pymupdf(input_pdf_path, output_txt_path)\n```\n\n## 実行方法\n\n上記コードを `text_extract.py` として保存し、以下のコマンドで実行します：\n\n```bash\npython3 text_extract.py\n```\n\n## 結果\n\n実行すると、PDFのテキストが抽出され、以下のような結果が得られます：\n\n```\n \n \n1 \n \n文書のタイトル \n見出し1 \n \n見出し1-1 \nここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここには見\n出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の\n本文が入ります。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入り\nます。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここ\nには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。 \n \n見出し1-2 \nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。ここには見\n出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。ここには見出し1-2 の\n本文が入ります。ここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入り\nます。 \nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。 \n \n \n2 \n \nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。 \n \n見出し1-3 \nここには見出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。 \nここには見出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。ここには見\n出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。ここには見出し1-3 の\n本文が入ります。ここには見出し1-3 の本文が入ります。 \n \n \n \n \n3 \n \n列1 \n列2 \n列3 \n列4 \n行1 列1 の本文が入\nります。 \n行1 列2 の本文が入\nります。 \n行1 列3 の本文が入\nります。 \n行1 列4 の本文が入\nります。 \n行2 列1 の本文が入\nります。 \n行2 列2 の本文が入\nります。 \n行2 列3 の本文が入\nります。 \n行2 列4 の本文が入\nります。 \n行3 列1 の本文が入\nります。 \n行3 列2 の本文が入\nります。 \n行3 列3 の本文が入\nります。 \n行3 列4 の本文が入\nります。 \n表1. 表1 の名前が入ります。 \n \n列1 \n列2 \n列3 \n列4 \n行1 列1 の本文が\n入ります。 \n行1 列2 の本文が\n入ります。 \n行1 列3 の本文が\n入ります。 \n行1 列4 の本文が\n入ります。 \n行2 列1 の本文が\n入ります。 \n行2 列2 の本文が\n入ります。 \n行2 列3 の本文が\n入ります。 \n行2 列4 の本文が\n入ります。 \n表2. 表2 の名前が入ります。 \n見出し1-4 \nここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここには見\n \n \n4 \n \n出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の\n本文が入ります。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入り\nます。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここ\nには見出し1-4 の本文が入ります。 \n \n \n \n \n5 \n \n見出し2 \n \n(項目名が入ります) \n見出し2-1 ここには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入り\nます。ここには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。ここ\nには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。ここには見出し\n2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。 \n \n(項目名が入ります) \n見出し2-2 ここには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入り\nます。ここには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入ります。ここ\nには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入ります。ここには見出し\n2-2 の本文が入ります。 \nここには見出し2-2 の本文が入ります。 \n \n以上 \n \n \n\n```\n\n---\n\n# PyMuPDFを使った表抽出\n\nPyMuPDFでは、PDF内の表をリスト形式で抽出することができます。\n\n## サンプルコード\n\n以下は、表を抽出してMarkdown形式で保存する例です：\n\n```python\nimport pymupdf\nimport os\n\ninput_pdf_path = \"./docs/読み取りテスト文書.pdf\"\noutput_txt_path = \"./output/table_extract.txt\"\n\ndef extract_tables_with_pymupdf(input_path, output_path):\n    doc = pymupdf.open(input_path)\n    for i, page in enumerate(doc, start=1):\n        tabs = page.find_tables()\n        print(f\"{len(tabs.tables)} found on {page}\")\n        if tabs.tables:\n            for table in tabs.tables:\n                extracted_text = table.to_markdown()\n\n                output_dir = os.path.dirname(output_path)\n                if not os.path.exists(output_dir):\n                    os.makedirs(output_dir)\n\n                with open(output_path, \"w\", encoding=\"utf-8\") as f:\n                    f.write(extracted_text)\n\nif __name__ == \"__main__\":\n    extract_tables_with_pymupdf(input_pdf_path, output_txt_path)\n```\n\n## 実行方法\n\nコードを `table_extract.py` として保存し、以下のコマンドで実行します：\n\n```bash\npython3 table_extract.py\n```\n\n## 結果\n\n以下のようなMarkdown形式のテーブルが出力されます：\n\n```markdown\n|列1|列2|列3|列4|\n|---|---|---|---|\n|行 1 列 1 の本文が 入ります。|行1 列 2 の本文が 入ります。|行1 列 3 の本文が 入ります。|行1 列 4 の本文が 入ります。|\n|行 2 列 1 の本文が 入ります。|行2 列 2 の本文が 入ります。|行2 列 3 の本文が 入ります。|行2 列 4 の本文が 入ります。|\n\n```\n\n---\n\n# PyMuPDF4LLMで効率化\n\nLLMやRAG向けに特化したPyMuPDFの派生ライブラリ**PyMuPDF4LLM**も非常に便利です。これを使えば、PDF全体をMarkdown形式で抽出できます。\n\n## インストール\n\n```bash\npip install pymupdf4llm\n```\n\n## サンプルコード\n\n```python\nimport pymupdf4llm\n\ninput_pdf_path = \"./docs/読み取りテスト文書.pdf\"\noutput_txt_path = \"./output/md_extract.md\"\n\ndef extract_md_with_pymupdf4llm(input_path, output_path):\n    md_text = pymupdf4llm.to_markdown(input_path)\n    with open(output_path, \"w\", encoding=\"utf-8\") as f:\n        f.write(md_text)\n\nif __name__ == \"__main__\":\n    extract_md_with_pymupdf4llm(input_pdf_path, output_txt_path)\n\n```\n\n## 実行方法\n\n以下のコマンドで実行します：\n\n```bash\npython3 md_extract.py\n```\n\n## 結果\n\nPDFの内容が見出しやテーブル付きでMarkdown形式に変換されます：\n\n```markdown\n# 文書のタイトル\n\n## 見出し1\n\n### 見出し1-1\n\nここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここには見\n\n出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の\n\n本文が入ります。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入り\n\nます。ここには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。ここ\n\nには見出し1-1 の本文が入ります。ここには見出し1-1 の本文が入ります。\n\n### 見出し1-2\n\nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。ここには見\n\n出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。ここには見出し1-2 の\n\n本文が入ります。ここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入り\n\nます。\n\nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。\n\n1\n\n-----\n\nここには見出し1-2 の本文が入ります。ここには見出し1-2 の本文が入ります。\n\n### 見出し1-3\n\nここには見出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。\n\nここには見出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。ここには見\n\n出し1-3 の本文が入ります。ここには見出し1-3 の本文が入ります。ここには見出し1-3 の\n\n本文が入ります。ここには見出し1-3 の本文が入ります。\n\n2\n\n-----\n\n|列1|列2|列3|列4|\n|---|---|---|---|\n|行1 列1 の本文が入 ります。|行1 列2 の本文が入 ります。|行1 列3 の本文が入 ります。|行1 列4 の本文が入 ります。|\n|行2 列1 の本文が入 ります。|行2 列2 の本文が入 ります。|行2 列3 の本文が入 ります。|行2 列4 の本文が入 ります。|\n|行3 列1 の本文が入 ります。|行3 列2 の本文が入 ります。|行3 列3 の本文が入 ります。|行3 列4 の本文が入 ります。|\n\n表1. 表1 の名前が入ります。\n\n列1 列2 列3 列4\n\n行1 列1 の本文が 行1 列2 の本文が 行1 列3 の本文が 行1 列4 の本文が\n\n入ります。 入ります。 入ります。 入ります。\n\n行2 列1 の本文が 行2 列2 の本文が 行2 列3 の本文が 行2 列4 の本文が\n\n入ります。 入ります。 入ります。 入ります。\n\n表2. 表2 の名前が入ります。\n\n### 見出し1-4\n\nここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここには見\n\n3\n\n|列1|列2|列3|列4|\n|---|---|---|---|\n|行 1 列 1 の本文が 入ります。|行1 列 2 の本文が 入ります。|行1 列 3 の本文が 入ります。|行1 列 4 の本文が 入ります。|\n|行 2 列 1 の本文が 入ります。|行2 列 2 の本文が 入ります。|行2 列 3 の本文が 入ります。|行2 列 4 の本文が 入ります。|\n\n-----\n\n出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の\n\n本文が入ります。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入り\n\nます。ここには見出し1-4 の本文が入ります。ここには見出し1-4 の本文が入ります。ここ\n\nには見出し1-4 の本文が入ります。\n\n4\n\n-----\n\n## 見出し2\n\n(項目名が入ります)\n\n### 見出し2-1 ここには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入り\n\nます。ここには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。ここ\n\nには見出し2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。ここには見出し\n\n2-1 の本文が入ります。ここには見出し2-1 の本文が入ります。\n\n(項目名が入ります)\n\n### 見出し2-2 ここには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入り\n\nます。ここには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入ります。ここ\n\nには見出し2-2 の本文が入ります。ここには見出し2-2 の本文が入ります。ここには見出し\n\n2-2 の本文が入ります。\n\nここには見出し2-2 の本文が入ります。\n\n以上\n\n5\n\n-----\n\n```\n\n---\n\n## PyMuPDFのメリットと活用方法\n\n- **テキストと表を統合的に扱える**。\n- **高速かつ効率的**に処理可能。\n- **Markdown形式での出力**に対応しており、RAGやLLMに最適。\n\nPyMuPDFを活用して、PDFデータの前処理を効率化し、プロジェクトの生産性を向上させましょう！\n\n---\n\n","createdAt":"2025-05-19T08:50:58.180Z","updatedAt":"2025-06-06T00:00:42.726Z","publishedAt":"2025-06-06T00:00:42.741Z","docId":"rk1h39ybmhc4dqtmxcavaw3w","tags":[{"id":20,"documentId":"fbllyhmskvu2l7wbg5dzpkri","createdAt":"2025-05-19T09:48:50.341Z","updatedAt":"2025-05-19T09:48:50.341Z","publishedAt":"2025-05-19T09:48:50.348Z","name":"LLM"},{"id":22,"documentId":"enpfq0z697dadtxijwpwwrsv","createdAt":"2025-05-19T09:49:17.862Z","updatedAt":"2025-05-19T09:49:17.862Z","publishedAt":"2025-05-19T09:49:17.870Z","name":"Python"},{"id":24,"documentId":"l1dya7wtq2ct0n1dxm41pl7j","createdAt":"2025-05-19T09:49:40.953Z","updatedAt":"2025-05-19T09:49:40.953Z","publishedAt":"2025-05-19T09:49:40.961Z","name":"RAG"}],"thumbnail":[{"id":23,"documentId":"lcfxgy80xu29o0ot2kt8p1ac","name":"20250513-19.png","alternativeText":null,"caption":null,"width":1504,"height":844,"formats":{"thumbnail":{"name":"thumbnail_20250513-19.png","hash":"thumbnail_20250513_19_a28071974b","ext":".png","mime":"image/png","path":null,"width":245,"height":137,"size":15.19,"sizeInBytes":15193,"url":"https://stg-raisex-tech-blog.s3.ap-northeast-1.amazonaws.com/thumbnail_20250513_19_a28071974b.png"},"medium":{"name":"medium_20250513-19.png","hash":"medium_20250513_19_a28071974b","ext":".png","mime":"image/png","path":null,"width":750,"height":421,"size":57.89,"sizeInBytes":57886,"url":"https://stg-raisex-tech-blog.s3.ap-northeast-1.amazonaws.com/medium_20250513_19_a28071974b.png"},"small":{"name":"small_20250513-19.png","hash":"small_20250513_19_a28071974b","ext":".png","mime":"image/png","path":null,"width":500,"height":281,"size":36.56,"sizeInBytes":36563,"url":"https://stg-raisex-tech-blog.s3.ap-northeast-1.amazonaws.com/small_20250513_19_a28071974b.png"},"large":{"name":"large_20250513-19.png","hash":"large_20250513_19_a28071974b","ext":".png","mime":"image/png","path":null,"width":1000,"height":561,"size":81.1,"sizeInBytes":81104,"url":"https://stg-raisex-tech-blog.s3.ap-northeast-1.amazonaws.com/large_20250513_19_a28071974b.png"}},"hash":"20250513_19_a28071974b","ext":".png","mime":"image/png","size":22.9,"url":"https://stg-raisex-tech-blog.s3.ap-northeast-1.amazonaws.com/20250513_19_a28071974b.png","previewUrl":null,"provider":"@strapi/provider-upload-aws-s3","provider_metadata":null,"createdAt":"2025-05-20T07:49:55.882Z","updatedAt":"2025-05-20T07:49:55.882Z","publishedAt":"2025-05-20T07:49:55.882Z"}]}},"__N_SSG":true}